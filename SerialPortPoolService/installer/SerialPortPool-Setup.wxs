<?xml version="1.0" encoding="UTF-8"?>
<!-- SerialPortPool-Setup-Simple.wxs - Simplified version without problematic elements -->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <!-- Product Definition -->
  <Product Id="*" 
           Name="SerialPortPool Service" 
           Language="1033" 
           Version="1.0.0.0" 
           Manufacturer="SerialPortPool Solutions" 
           UpgradeCode="12345678-1234-1234-1234-123456789012">
    
    <Package InstallerVersion="200" 
             Compressed="yes" 
             InstallScope="perMachine"
             Description="Professional serial port pool management service" />

    <!-- Media and Cabinet -->
    <MediaTemplate EmbedCab="yes" />

    <!-- Major Upgrade Logic -->
    <MajorUpgrade DowngradeErrorMessage="A newer version of SerialPortPool is already installed." />

    <!-- Installation Directory Structure -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <!-- Program Files -->
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="SerialPortPool">
          
          <!-- Main Service Directory -->
          <Directory Id="ServiceDir" Name="Service" />
          
          <!-- Configuration Directory -->
          <Directory Id="ConfigDir" Name="Configuration" />
          
          <!-- Documentation Directory -->
          <Directory Id="DocsDir" Name="Documentation" />
          
        </Directory>
      </Directory>

      <!-- Logs Directory (C:\Logs\SerialPortPool) -->
      <Directory Id="CommonAppDataFolder">
        <Directory Id="LogsRootDir" Name="Logs">
          <Directory Id="LogsDir" Name="SerialPortPool" />
        </Directory>
      </Directory>
    </Directory>

    <!-- Components -->
    
    <!-- Main Service Component -->
    <Component Id="ServiceExecutable" Guid="*" Directory="ServiceDir">
      <File Id="ServiceExe" 
            Source="$(var.SourceDir)\SerialPortPoolService.exe" 
            KeyPath="yes" />
      <File Id="NLogConfig" 
            Source="$(var.SourceDir)\NLog.config" />
      
      <!-- Service Dependencies -->
      <File Id="CoreLibrary" 
            Source="$(var.SourceDir)\SerialPortPool.Core.dll" />
      <File Id="NLogDll" 
            Source="$(var.SourceDir)\NLog.dll" />
      <File Id="NLogExtensions" 
            Source="$(var.SourceDir)\NLog.Extensions.Logging.dll" />
      
      <!-- Windows Service Installation -->
      <ServiceInstall Id="SerialPortPoolServiceInstall"
                      Name="SerialPortPoolService"
                      DisplayName="SerialPortPool Service"
                      Description="Professional serial port pool management service"
                      Type="ownProcess"
                      Start="auto"
                      Account="LocalSystem"
                      ErrorControl="normal"
                      Interactive="no" />
      
      <!-- Service Control -->
      <ServiceControl Id="SerialPortPoolServiceControl"
                      Name="SerialPortPoolService"
                      Start="install"
                      Stop="both"
                      Remove="uninstall"
                      Wait="yes" />
    </Component>

    <!-- Configuration Component -->
    <Component Id="DefaultConfiguration" Guid="*" Directory="ConfigDir">
      <File Id="DefaultSettings" 
            Source="$(var.SourceDir)\default-settings.json" 
            KeyPath="yes" />
    </Component>

    <!-- Documentation Component -->
    <Component Id="Documentation" Guid="*" Directory="DocsDir">
      <File Id="ReadmeMVP" 
            Source="$(var.SourceDir)\README-MVP.txt" 
            KeyPath="yes" />
    </Component>

    <!-- Logs Directory Component - Simplified without PermissionEx -->
    <Component Id="LogsDirectory" Guid="*" Directory="LogsDir">
      <CreateFolder />
    </Component>

    <!-- Registry Component for Configuration -->
    <Component Id="RegistryEntries" Guid="*" Directory="TARGETDIR">
      <!-- Installation Path -->
      <RegistryKey Root="HKLM" Key="SOFTWARE\SerialPortPool">
        <RegistryValue Name="InstallPath" 
                       Type="string" 
                       Value="[INSTALLFOLDER]" />
        <RegistryValue Name="Version" 
                       Type="string" 
                       Value="1.0.0.0" />
        <RegistryValue Name="ServiceName" 
                       Type="string" 
                       Value="SerialPortPoolService" />
      </RegistryKey>
      
      <!-- Uninstall Information -->
      <RegistryKey Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\SerialPortPool">
        <RegistryValue Name="DisplayName" 
                       Type="string" 
                       Value="SerialPortPool Service" />
        <RegistryValue Name="DisplayVersion" 
                       Type="string" 
                       Value="1.0.0.0" />
        <RegistryValue Name="Publisher" 
                       Type="string" 
                       Value="SerialPortPool Solutions" />
        <RegistryValue Name="InstallLocation" 
                       Type="string" 
                       Value="[INSTALLFOLDER]" />
      </RegistryKey>
    </Component>

    <!-- Features -->
    <Feature Id="MainFeature" 
             Title="SerialPortPool Service" 
             Description="Core service and components" 
             Level="1"
             ConfigurableDirectory="INSTALLFOLDER">
      <ComponentRef Id="ServiceExecutable" />
      <ComponentRef Id="LogsDirectory" />
      <ComponentRef Id="RegistryEntries" />
    </Feature>

    <Feature Id="ConfigurationFeature" 
             Title="Configuration Files" 
             Description="Default configuration templates" 
             Level="1">
      <ComponentRef Id="DefaultConfiguration" />
    </Feature>

    <Feature Id="DocumentationFeature" 
             Title="Documentation" 
             Description="User guides and documentation" 
             Level="1">
      <ComponentRef Id="Documentation" />
    </Feature>

    <!-- Installation Properties -->
    <Property Id="MSIUSEREALADMINDETECTION" Value="1" />
    
    <!-- Prevent installation on non-Windows platforms -->
    <Condition Message="This application requires Windows 10 or later.">
      <![CDATA[Installed OR (VersionNT >= 1000)]]>
    </Condition>
    
    <!-- Require administrator privileges -->
    <Condition Message="This application requires administrator privileges.">
      <![CDATA[Installed OR Privileged]]>
    </Condition>

  </Product>
</Wix>