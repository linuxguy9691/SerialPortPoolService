<!-- SerialPortPool-Setup-SingleFile.wxs -->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="SerialPortPool Service" Version="1.0.0.0">
    
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="SerialPortPool">
          <Directory Id="ServiceDir" Name="Service" />
          <Directory Id="ConfigDir" Name="Configuration" />
        </Directory>
      </Directory>
    </Directory>

    <!-- SIMPLIFIÉ : Un seul exécutable ! -->
    <Component Id="ServiceExecutable" Guid="*" Directory="ServiceDir">
      <File Id="ServiceExe" 
            Source="$(var.SourceDir)\SerialPortPoolService.exe" 
            KeyPath="yes" />
      
      <!-- Seulement les fichiers de config -->
      <File Id="NLogConfig" 
            Source="$(var.SourceDir)\NLog.config" />
      
      <!-- Service Installation -->
      <ServiceInstall Id="SerialPortPoolServiceInstall"
                      Name="SerialPortPoolService"
                      DisplayName="SerialPortPool Service"
                      Type="ownProcess"
                      Start="auto"
                      Account="LocalSystem" />
      
      <ServiceControl Id="SerialPortPoolServiceControl"
                      Name="SerialPortPoolService"
                      Start="install"
                      Stop="both"
                      Remove="uninstall" />
    </Component>

    <!-- Configuration Files -->
    <Component Id="ConfigFiles" Guid="*" Directory="ConfigDir">
      <File Id="DefaultSettings" 
            Source="$(var.SourceDir)\default-settings.json" />
      <File Id="BibConfigurations" 
            Source="$(var.SourceDir)\bib-configurations.json" />
    </Component>

    <Feature Id="MainFeature" Title="SerialPortPool Service" Level="1">
      <ComponentRef Id="ServiceExecutable" />
      <ComponentRef Id="ConfigFiles" />
    </Feature>

  </Product>
</Wix>